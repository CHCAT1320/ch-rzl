var msgBoxI = [];

var msg = ["ä½ åˆ°åº•å›žä¸å›žï¼Ÿæˆ‘æ°”ç‚¸äº†ï¼ðŸ˜ ","å‘é‚£ä¹ˆå¤šä¸å›žï¼Œä½ æ ¹æœ¬ä¸åœ¨ä¹Žæˆ‘ï¼","æ•…æ„æ™¾æˆ‘æ˜¯å§ï¼Ÿæˆ‘è¶…ç”Ÿæ°”ï¼ðŸ’¢","æ¶ˆæ¯æ²¡å›žéŸ³ï¼Œä½ ä»€ä¹ˆæ„æ€å•Šï¼","æ‡’å¾—å›žæ¶ˆæ¯ï¼Ÿæˆ‘å¿«å¿ä¸äº†äº†ï¼ðŸ˜¤","ä¸å›žè¿˜æ¶ˆå¤±ï¼Œæˆ‘ä¸€è‚šå­ç«ï¼ðŸ”¥","çœ¼é‡Œæ²¡æˆ‘æ˜¯å§ï¼Ÿè¶Šæƒ³è¶Šæ°”ï¼","ä¸å›žæ¶ˆæ¯ï¼Œä½ æ¬ºè´Ÿæˆ‘å‘¢ï¼ŸðŸ˜¡","ç­‰ä¸åˆ°å›žå¤ï¼Œæˆ‘æ°”åˆ°å‘æŠ–ï¼","ä¸å›žå°±ç®—äº†ï¼Œè¿žè§£é‡Šéƒ½æ²¡ï¼Ÿ","å¿™åˆ°æ²¡ç©ºå›žï¼Ÿéª—è°å‘¢ï¼ðŸ’¢","æ²¡å›žéŸ³çš„æ€åº¦ï¼Œå¤ªè¿‡åˆ†äº†ï¼ðŸ˜ ","æˆ‘ç€æ€¥ç­‰ä½ ï¼Œä½ å´ä¸æ­ç†ï¼","è£…æ²¡çœ‹è§ï¼Ÿæˆ‘çœŸçš„æ°”ç‚¸äº†ï¼ðŸ˜¤","æ•…æ„è®©æˆ‘ç”Ÿæ°”æ˜¯å§ï¼Ÿå¤ªè¿‡åˆ†ï¼ðŸ”¥","è¿™ä¹ˆå¯¹æˆ‘ï¼Ÿå¤±æœ›åˆç”Ÿæ°”ï¼","ç­‰åŠå¤©æ²¡å½±ï¼Œæˆ‘æ°”åäº†ï¼ðŸ˜¡","ä¸å›žæ¶ˆæ¯ï¼Œä½ æžä»€ä¹ˆå•Šï¼","æ²¡å°Šé‡ï¼æˆ‘çœŸçš„è¶…ç”Ÿæ°”ï¼ðŸ’¢","æ¶ˆå¤±å°±ç®—äº†ï¼Ÿæˆ‘ä¸ä¼šéš¾è¿‡å—ï¼Ÿ","æ²¡å›žéŸ³ï¼Œä½ å¿ƒé‡Œæœ‰æˆ‘å—ï¼ŸðŸ˜ ","æŠŠæˆ‘å½“ç©ºæ°”ï¼Ÿæˆ‘å¿«æ°”æ­»äº†ï¼","æ— æ‰€è°“æ˜¯å§ï¼Ÿæˆ‘æ°”åˆ°å“­ï¼ðŸ˜¤","æ™¾ç€æˆ‘ï¼Ÿæˆ‘ä¸€è‚šå­ç«ï¼ðŸ”¥","çŸ³æ²‰å¤§æµ·ï¼Œä½ å¤ªä¼¤äººäº†ï¼ðŸ˜¡","è£…æ­»ï¼Ÿä½ æƒ³æ€Žä¹ˆæ ·å•Šï¼","æˆ‘æ‹…å¿ƒåˆæ°”ï¼Œä½ ä¸å›žåº”ï¼ðŸ’¢","ä¸å›žæ¶ˆæ¯ï¼Œä½ æ ¹æœ¬ä¸åœ¨ä¹Žï¼ðŸ˜ ","ç­‰ä¸åˆ°æ¶ˆæ¯ï¼Œæˆ‘è¶…æ¼ç«ï¼","å¤±è”ï¼Ÿä½ å¤ªè¿‡åˆ†äº†ï¼ðŸ˜¤","æ•…æ„ä¸ç†æˆ‘ï¼Ÿæˆ‘æ°”ç‚¸äº†ï¼ðŸ”¥","è¿™æ€åº¦ï¼Œæˆ‘çœŸçš„å¾ˆç”Ÿæ°”ï¼ðŸ˜¡","ç­‰åŠå¤©æ²¡åŠ¨é™ï¼Œåˆæ°”åˆå§”å±ˆï¼","ä¸å›žå°±ç®—äº†ï¼Œæ²¡äº¤ä»£ï¼ŸðŸ’¢","æ²¡ç©ºå›žï¼Ÿæˆ‘æ‰ä¸ä¿¡ï¼ðŸ˜ ","æ¶ˆå¤±ï¼Ÿä½ è§‰å¾—æˆ‘å¥½å“„ï¼Ÿ","ä¸æŠŠæˆ‘å½“å›žäº‹ï¼Ÿæˆ‘è¶…æ°”ï¼ðŸ˜¤","æ²¡å›žéŸ³ï¼Œä½ ä»€ä¹ˆæ„æ€ï¼ðŸ”¥","è£…æ²¡çœ‹è§ï¼Ÿæˆ‘æ°”åˆ°ä¸è¡Œï¼ðŸ˜¡","è¿™ä¹ˆå¯¹æˆ‘ï¼Ÿæˆ‘ç‰¹åˆ«ç”Ÿæ°”ï¼ðŸ’¢","æ²¡è€ƒè™‘æˆ‘æ„Ÿå—ï¼Ÿå¤ªæ°”äººï¼ðŸ˜ ","æ•…æ„è®©æˆ‘ä¸Šç«æ˜¯å§ï¼Ÿ","å¿ä¸ä¸‹åŽ»äº†ï¼ä½ å¤ªè¿‡åˆ†ï¼ðŸ˜¤","çœ¼é‡Œæ²¡æˆ‘ï¼Ÿå‘æ¶ˆæ¯ä¸å›žï¼ðŸ”¥","æˆ‘åˆæ°”åˆæ€¥ï¼Œä½ ä¸æ­ç†ï¼ðŸ˜¡","æ¶ˆå¤±ï¼Ÿæˆ‘å¤ªå¤±æœ›äº†ï¼ðŸ’¢","ç­‰åŠå¤©æ²¡å›žå¤ï¼Œæ°”ç‚¸äº†ï¼ðŸ˜ ","è£…æ­»ï¼Ÿæˆ‘çœŸçš„å—ä¸äº†ï¼","æ™¾ç€æˆ‘ï¼Ÿç«æ²¡å¤„æ’’ï¼ðŸ˜¤","ä¸å›žæ¶ˆæ¯ï¼Œä½ ä¸åœ¨ä¹Žæˆ‘ï¼ðŸ”¥","å¤ªä¼¤äººäº†ï¼æ¶ˆæ¯çŸ³æ²‰å¤§æµ·ï¼ðŸ˜¡","æ²¡åŠ¨é™ï¼Œæˆ‘çœŸçš„è¶…ç”Ÿæ°”ï¼ðŸ’¢","è£…æ²¡çœ‹è§ï¼Ÿä½ ä»€ä¹ˆæ„æ€ï¼ðŸ˜ ","æ²¡ç©ºå›žï¼Ÿéª—è°å‘¢ï¼","æ²¡å›žéŸ³ï¼Œå¿ƒé‡Œæœ‰æˆ‘å—ï¼ŸðŸ˜¤","è¶Šæƒ³è¶Šæ°”ï¼ç­‰ä¸åˆ°å›žå¤ï¼ðŸ”¥","æ¶ˆå¤±ï¼Ÿä½ å¤ªè¿‡åˆ†äº†ï¼ðŸ˜¡","è¿™ä¹ˆå¯¹æˆ‘ï¼Ÿæˆ‘å¿«æ°”å“­äº†ï¼ðŸ’¢","æ²¡æŠŠæˆ‘å½“å›žäº‹ï¼æ°”ç‚¸äº†ï¼ðŸ˜ ","æ•…æ„æ°”æˆ‘ï¼Ÿæˆ‘å¿ä¸äº†ï¼","çœ¼é‡Œæ²¡æˆ‘ï¼Ÿå‘æ¶ˆæ¯ä¸å›žï¼ðŸ˜¤","å¤±è”ï¼Ÿæˆ‘å¤ªå¤±æœ›äº†ï¼ðŸ”¥","ç­‰åŠå¤©æ²¡å½±ï¼Œæ°”åäº†ï¼ðŸ˜¡","è£…æ­»ï¼Ÿæˆ‘æ°”åˆ°ä¸è¡Œï¼ðŸ’¢","æ™¾ç€æˆ‘ï¼Ÿç‰¹åˆ«æ¼ç«ï¼ðŸ˜ ","æ²¡å›žéŸ³ï¼Œä½ ä»€ä¹ˆæ„æ€ï¼","å¤ªä¼¤äººï¼æ¶ˆæ¯çŸ³æ²‰å¤§æµ·ï¼ðŸ˜¤","æ²¡åŠ¨é™ï¼Œè¶Šæƒ³è¶Šæ°”ï¼ðŸ”¥","æ•…æ„ä¸ç†ï¼Ÿæˆ‘æ°”ç‚¸äº†ï¼ðŸ˜¡","æ²¡ç©ºå›žï¼Ÿæˆ‘æ‰ä¸ä¿¡ï¼ðŸ’¢","å¿ƒé‡Œæœ‰æˆ‘å—ï¼Ÿæ²¡å›žéŸ³ï¼ðŸ˜ ","ç«æ²¡å¤„å‘ï¼ç­‰ä¸åˆ°å›žå¤ï¼","æ¶ˆå¤±ï¼Ÿä½ å¤ªè¿‡åˆ†äº†ï¼ðŸ˜¤","è¿™ä¹ˆå¯¹æˆ‘ï¼Ÿæˆ‘è¶…ç”Ÿæ°”ï¼ðŸ”¥","æ²¡è€ƒè™‘æˆ‘ï¼å¤ªæ°”äººäº†ï¼ðŸ˜¡","æ•…æ„ä¸Šç«ï¼Ÿæˆ‘å¿ä¸äº†ï¼ðŸ’¢","çœ¼é‡Œæ²¡æˆ‘ï¼Ÿä¸å›žæ¶ˆæ¯ï¼ðŸ˜ ","åˆæ°”åˆæ€¥ï¼ä½ ä¸æ­ç†ï¼","æ¶ˆå¤±ï¼Ÿæˆ‘å¤ªå¤±æœ›äº†ï¼ðŸ˜¤","æ²¡å›žå¤ï¼Ÿæˆ‘æ°”ç‚¸äº†ï¼ðŸ”¥","è£…æ­»ï¼ŸçœŸçš„å—ä¸äº†ï¼ðŸ˜¡","æ™¾ç€æˆ‘ï¼Ÿç«æ²¡å¤„æ’’ï¼ðŸ’¢","ä¸åœ¨ä¹Žæˆ‘ï¼Ÿä¸å›žæ¶ˆæ¯ï¼ðŸ˜ ","å¤ªä¼¤äººï¼æ¶ˆæ¯æ²¡å›žéŸ³ï¼","æ²¡åŠ¨é™ï¼Œæˆ‘è¶…ç”Ÿæ°”ï¼ðŸ˜¤"]

var imgQQWV = [new Image(), new Image()]
imgQQWV[0].src = "../wx.webp"
imgQQWV[1].src = "../qq.png"

class msgBox {
    constructor(time, fatherY) {
        this.time = time;
        this.holdTime = 3;
        this.transitionTime = 0.5;
        this.fatherY = fatherY - 60;
        this.y = fatherY;
        // èƒ¶å›Šå°ºå¯¸å‚æ•°ï¼ˆè°ƒæ•´åœ†è§’åŠå¾„ï¼‰
        this.width = 270 * (cvs.width / 360);
        this.height = 60 * (cvs.height / 640);
        this.radius = 23 * (cvs.width / 360); // åœ†è§’åŠå¾„è®¾ä¸º15pxï¼ˆå¯æ ¹æ®éœ€è¦è°ƒæ•´ï¼‰ï¼Œå°äºŽé«˜åº¦çš„ä¸€åŠ
        this.show = Math.random() > 0.7
        // console.log(this.show)
        if (this.show) {
            // playSound(3)
            msgH.push({type: 3, time: time})
        }
        this.msgIndex = Math.floor(Math.random() * msg.length)
        this.imgIndex = Math.floor(Math.random() * 2)
    }
    easeOutBack(x) {
        const c1 = 1.70158;
        const c3 = c1 + 1;
        return 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2);
    }
    // ç»˜åˆ¶åœ†è§’çŸ©å½¢ï¼ˆèƒ¶å›Šçš„å¼±åŒ–ç‰ˆï¼‰
    drawRoundedRect(x, y, width, height, radius) {
        ctx.beginPath();
        // å·¦ä¸Šè§’
        ctx.moveTo(x + radius, y);
        // å³ä¸Šè§’
        ctx.arcTo(x + width, y, x + width, y + height, radius);
        // å³ä¸‹è§’
        ctx.arcTo(x + width, y + height, x, y + height, radius);
        // å·¦ä¸‹è§’
        ctx.arcTo(x, y + height, x, y, radius);
        // é—­åˆåˆ°å·¦ä¸Šè§’
        ctx.arcTo(x, y, x + width, y, radius);
        ctx.closePath();
        ctx.fill();
    }
    draw(time) {
        return
        if (this.show === false) return;
        if (time > this.time && time < this.time + this.transitionTime && time < this.time + this.holdTime) {
            const easeValue = this.easeOutBack((time - this.time) / this.transitionTime);
            this.y = this.fatherY + easeValue * 135 * (cvs.height / 640);
            const audio = document.getElementById('bgm')
            audio.volume = Math.max(0.2, 1 - easeValue)
        }
        if (time > this.time + this.holdTime && time < this.time + this.holdTime + this.transitionTime) {
            const t = (time - this.time - this.holdTime) / this.transitionTime;
            const easeValue = t * t * t * t;
            this.y = (this.fatherY + 125 * (cvs.height / 640)) - easeValue * 135 * (cvs.height / 640);
            const audio = document.getElementById('bgm')
            audio.volume = Math.max(1, easeValue)
        }
        // ç»˜åˆ¶åœ†è§’çŸ©å½¢
        ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
        this.drawRoundedRect(
            -this.width / 2,  // xåæ ‡ï¼ˆå±…ä¸­ï¼‰
            this.y - this.height,  // yåæ ‡
            this.width,  // å®½åº¦
            this.height,  // é«˜åº¦
            this.radius  // åœ†è§’åŠå¾„ï¼ˆå·²è°ƒæ•´ï¼‰
        );
        // ç»˜åˆ¶æ–‡å­—
        ctx.font = `${12 * (cvs.width / 360)}px rizline`;
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        const msgText = "å®å®ï¼š " + msg[this.msgIndex]
        const msgWidth = ctx.measureText(msgText).width
        const x = (-this.width / 2 + msgWidth / 2 + 50) * (cvs.width / 360)
        const y = (this.y - this.height / 2) * (cvs.height / 640)
        ctx.fillText(msgText, x + 20 * (cvs.width / 360), y);

        // ç»˜åˆ¶å¤´åƒ
        const imgX = ((-this.width / 2 + 20) * (cvs.width / 360)) * (cvs.width / 360)
        const imgY = ((this.y - this.height / 2 - 20) * (cvs.height / 640)) * (cvs.height / 640)
        ctx.drawImage(imgQQWV[this.imgIndex], imgX, imgY, 40 * (cvs.width / 360), 40 * (cvs.height / 640))
    }
}